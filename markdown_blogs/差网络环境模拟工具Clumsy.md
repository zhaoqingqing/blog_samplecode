**clumsy 能在 Windows 平台下人工造成不稳定的网络状况，方便你调试应用程序在极端网络状况下的表现。**

官网：https://jagt.github.io/clumsy/



### 简介

利用封装 Winodws Filtering Platform 的[WinDivert 库](http://reqrypt.org/windivert.html), clumsy 能实时的将系统接收和发出的网络数据包拦截下来，人工的造成延迟，掉包和篡改操作后再进行发送。无论你是要重现网络异常造成的程序错误，还是评估你的应用 程序在不良网络状况下的表现，clumsy 都能让你在不需要额外添加代码的情况下，在系统层次帮你达到想要的效果：

特色：     

- 下载即用，不需要安装任何东西。
- 不需要额外设置，不需要修改你的程序的代码。
- 系统级别的网络控制，可以适用于命令行，图形界面等任何 Windows 应用程序。
- 不仅仅只支持 HTTP，任何 TCP, UDP 的网络连接都可以被处理。
- 支持本地调试(服务器和客户端都在 localhost)
- "热插拔"，你的程序可以一直运行，而 clumsy 可以随时开启和关闭。
- 实时调节各种参数，详细控制网络情况。

### 如何使用

首先请根据你系统的版本(32位或64位)[下载](http://jagt.github.io/clumsy/cn/download.html) clumsy 最新版本。

注意如果你安装的是64位的系统那么一定要下载64位的 clumsy。

另一件重要的事实 clumsy 需要管理员权限才能正常工作。

双击打开 clumsy 的话会弹出 UAC 对话框。如果没有的话请右键点击 clumsy.exe 选择"以管理员身份运行"，或者这样设置： 右键 - 属性 - 兼容性 - 设置 - 勾选以管理员身份运行此程序 

### 动画演示

下面的动画展示了 clumsy 作用于一个本地的基于 netcat 的 UDP 服务器/客户端的情况。仔细观察你可以看到数据根据在 clumsy 的影响下产生了相应的变化。      

如果你基本知道了 clumsy 是干什么用的，不妨到[下载页面](http://jagt.github.io/clumsy/cn/download)选择适用于你系统的版本进行下载。

![img](http://static.oschina.net/uploads/img/201411/14065843_PsSP.gif)

### 详细信息

clumsy 首先根据用户选择的 *filter* 来拦截指定的网络数据。

在 filter 中可以设定你感兴趣的协议(tcp/udp)，端口号，是接收还是发出的端口。

你也可以通过简单的逻辑语句来进一步缩小范围。

当 clumsy 被激活时，只有符合这些标准的网络数据会被进行处理，而你不感兴趣的数据仍然会由系统正常传输。

当被 filter 的网络数据包被拦截后，你可以选择 clumsy 提供的功能来有目的性的调整网络情况：

1. 延迟(Lag)，把数据包缓存一段时间后再发出，这样能够模拟网络延迟的状况。
2. 掉包(Drop)，随机丢弃一些数据。
3. 节流(Throttle)，把一小段时间内的数据拦截下来后再在之后的同一时间一同发出去。
4. 重发(Duplicate)，随机复制一些数据并与其本身一同发送。
5. 乱序(Out of order)，打乱数据包发送的顺序。
6. 篡改(Tamper)，随机修改小部分的包裹内容。

尽管当前宽带网络连接十分普及，但网络传输其本身在本质上总不是稳定的。

如果你的应用程序中没有应对各种情况的处理，那么有可能一个丢失的 UDP 包裹都会让你的程序崩溃。

正确的调试这类行为       显然需要再代码结构上进行仔细的设计和处理，还会很花功夫。

而且在某些封装紧密的开发环境(Unity3D 自带的网络库可能是一个例子)下会更麻烦。clumsy 以尽可能减轻程序员负担为目标，希望提供一个简单方便（但并不完美）的解决方案。

### 丢包率测试

在局域网（正常情况下，零丢包）环境下，通过ping测试，不同丢包率下的实际丢包率。结果如下：

| Clumsy设置的丢包率 | 0%          | 5%          | 10%          | 20%          | 30%          | 40%          | 50%           | 60%          | 70%          | 80%          | 90%          |
| ------------------ | ----------- | ----------- | ------------ | ------------ | ------------ | ------------ | ------------- | ------------ | ------------ | ------------ | ------------ |
| ping实验丢包率     | 0%（734次） | 6%（677次） | 11%（782次） | 19%（506次） | 38%（725次） | 38%（725次） | 51%（1120次） | 58%（823次） | 70%（544次） | 84%（604次） | 91%（455次） |
|                    |             |             |              |              |              |              |               |              |              |              |              |

实验结果来自：https://blog.csdn.net/u010536377/java/article/details/45272665



参考内容：[使用 clumsy 模拟极端网络状况](https://blog.csdn.net/just__like/article/details/100659671)